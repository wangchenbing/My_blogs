---
title: 封装组件
date: 2024-10-08
tag:
 - React

---

## 获取html文本

```jsx
 const dangerousFun = (data:string) => {
    return <div
      dangerouslySetInnerHTML={{
        __html: data,
      }}
    />
  }

  <div>
    {dangerousFun(` <div> <p>返回的字段</p></div>`)}
  </div>
```

## 纯前端筛选

```jsx
// index.tsx
import React, { useState } from 'react';
import { Input } from 'antd';
import './index.less';
import TemplateCom from '@/components/Globol/TemplatCom';
import { typeList1, typeList2, listData, ParamsData } from './typeList';

export default (props: any) => {
  const [params, setParams] = useState<ParamsData>({
    areaType: 0,
    policyType: null,
  });

  const [keyword, setKeyWord] = useState('');

  //获取切换字段,通过标识符区分
  const handleClick = (value: string, type: string) => {
    console.log(value, type);
    setParams({
      areaType: Number(type === 'area' ? value : params.areaType),
      policyType: type === 'policyType' ? value : params.policyType,
    });
  };
  //获取输入框内容
  const handleChangeInput = (e: any) => {
    console.log(e.target.value);
    setKeyWord(e.target.value);
  };

  const handleChangeData = () => {
    const { areaType, policyType } = params;
    let _data = listData;
    if (keyword) {
      _data = _data.filter(
        (item) => item.policyName && item.policyName.includes(keyword),
      );
    }
    if (areaType) {
      _data = _data.filter((item) => item.areaType === areaType);
    }
    if (policyType) {
      _data = _data.filter((item) => item.policyType === policyType);
    }
    console.log(keyword, areaType, policyType, _data);
    return _data;
  };
  const filterData = handleChangeData();

  return (
    <TemplateCom {...props}>
      <Input
        placeholder="搜索"
        style={{ width: '90%', marginBottom: 10 }}
        onChange={(e) => handleChangeInput(e)}
      />
      <div>
        <ul style={{ display: 'flex', padding: '0px', marginBottom: 9 }}>
          {typeList1.map((item, i) => (
            <li
              key={i}
              className={`tags-item ${params.areaType === item.key && 'active'
                }`}
              onClick={() => handleClick(item.key, 'area')}
            >
              {item.name}
            </li>
          ))}
        </ul>
        <ul style={{ display: 'flex', padding: '0px' }}>
          {typeList2.map((item, i) => (
            <li
              key={i}
              className={`tags-item ${params.policyType === item.key && 'active'
                }`}
              onClick={() => handleClick(item.key, 'policyType')}
            >
              {item.name}
            </li>
          ))}
        </ul>
      </div>
      <ul>
        {filterData.map((item, index) => (
          <li key={index}>{item.policyName}</li>
        ))}
      </ul>
    </TemplateCom>
  );
};

```

```jsx
//typeList.ts
export const listData = [
  { policyName: '市级类型1', key: 1, areaType: 1, policyType: '类型1' },
  { policyName: '市级类型2', key: 2, areaType: 1, policyType: '类型2' },
  { policyName: '区县类型1', key: 3, areaType: 2, policyType: '类型1' },
  { policyName: '区县类型2', key: 4, areaType: 2, policyType: '类型2' },
  { policyName: '省级类型1', key: 5, areaType: 3, policyType: '类型1' },
]
export const typeList1 = [
  {
    name: '全部',
    key: 0
  },
  {
    name: '市级',
    key: 1
  },
  {
    name: '区县',
    key: 2
  },
]
export const typeList2 = [
  {
    name: '全部',
    key: null
  },
  {
    name: '类型1',
    key: '类型1'
  },
  {
    name: '类型2',
    key: '类型2'
  },
]
export interface ParamsData {
  areaType: number;
  policyType: any;
}



```
```jsx
// index.less
ul li {
  list-style: none
}

.tags-item {
  text-align: center;
  font-size: 14px;
  color: #1A2E42;
  padding: 3px 12px;
  border-radius: 4px;
  margin-left: 12px;
  cursor: pointer;
  transition: all .5s;
}

.tags-item.active {
  background-color: #FF6100;
  color: #fff;
}
```

## 手写虚拟列表
```jsx
import React, { useState, useEffect, useRef, Profiler, useMemo } from 'react';
import TemplateCom from '@/components/Globol/TemplatCom';
import { Button, InputNumber } from 'antd';

// 虚拟列表props接口
interface VirtualListProps {
  data: { name: string }[];
  itemHeight: number;
  visibleCount: number;
}

// 长列表props接口
interface LongListProps {
  data: { name: string }[];
  itemHeight: number;
}

// 由于VirtualList和LongList的数据类型相同，所以可以共用一个类型定义
type ListData = { name: string }[];

const VirtualList: React.FC<VirtualListProps> = ({
  data,
  itemHeight,
  visibleCount,
}) => {
  const [visibleStart, setVisibleStart] = useState(0);
  const listWrapRef = useRef<HTMLDivElement>(null);
  const handleScroll = () => {
    const scrollTop = listWrapRef.current?.scrollTop ?? 0;
    const startIndex = Math.floor(scrollTop / itemHeight);
    setVisibleStart(startIndex);
  };
  const visibleData = data.slice(visibleStart, visibleStart + visibleCount);

  return (
    <div
      className="virtualListWrap"
      ref={listWrapRef}
      onScroll={handleScroll}
      style={{
        height: `${itemHeight * visibleCount}px`,
        overflow: 'auto',
        position: 'relative',
      }}
    >
      <div
        className="placeholder"
        style={{ height: `${data.length * itemHeight}px` }}
      >
        {visibleData.map((item, index) => (
          <div
            key={index + visibleStart}
            style={{
              height: `${itemHeight}px`,
              top: `${(visibleStart + index) * itemHeight}px`,
              position: 'absolute',
              width: '100%',
              borderBottom: '1px solid #ccc',
              padding: '8px',
            }}
          >
            {item.name}
          </div>
        ))}
      </div>
    </div>
  );
};

const LongList: React.FC<LongListProps> = ({ data, itemHeight }) => {
  return (
    <div className="longListWrap" style={{ height: '400px', overflow: 'auto' }}>
      {data.map((item, index) => (
        <div
          key={index}
          style={{
            height: `${itemHeight}px`,
            borderBottom: '1px solid #ccc',
            padding: '8px',
          }}
        >
          {item.name}
        </div>
      ))}
    </div>
  );
};

export default (props: any) => {
  const [selectedListType, setSelectedListType] = useState<
    'virtual' | 'long' | null
  >(null);
  const [renderDuration, setRenderDuration] = useState<number | null>(null);
  const [data, setData] = useState<ListData>([]); // 使用useState管理数据
  const [dataSize, setDataSize] = useState<number>(300000);
  const itemHeight = 40; // 每个item的高度
  const visibleCount = 10; // 同时可见的item数量

  useEffect(() => {
    const initData: ListData = Array.from(
      { length: dataSize }, //30万条数据
      (_, index) => ({ name: `Item ${index + 1}` }),
    );
    setData(initData);
  }, [selectedListType]); // 仅在组件挂载时执行一次

  const onRenderCallback = (id: string, phase: any, actualDuration: any) => {
    setRenderDuration((prevDuration) => {
      // 如果前一个状态为 null 或者当前 actualDuration 大于之前记录的最大值，则更新状态
      return prevDuration === null || actualDuration > prevDuration
        ? actualDuration
        : prevDuration;
    });
  };

  const renderList = useMemo(() => {
    if (selectedListType === 'virtual') {
      return (
        <VirtualList
          data={data}
          itemHeight={itemHeight}
          visibleCount={visibleCount}
        />
      );
    } else if (selectedListType === 'long') {
      return <LongList data={data} itemHeight={itemHeight} />;
    }
  }, [selectedListType]);

  const onCancel = () => {
    setSelectedListType(null);
    setRenderDuration(null);
  };

  return (
    <TemplateCom {...props} onCancel={onCancel}>
      <div style={{ marginBottom: '15px' }}>
        渲染
        <InputNumber
          size="small"
          min={100}
          defaultValue={300000}
          onChange={(value: any) => setDataSize(value)}
        />
        条数据使用{renderDuration || 0}(毫秒)
      </div>
      <Button onClick={() => setSelectedListType('virtual')}>虚拟列表</Button>
      <Button onClick={() => setSelectedListType('long')}>普通列表</Button>
      <Button onClick={onCancel}>重制</Button>
      {selectedListType && (
        <Profiler id={selectedListType || 'None'} onRender={onRenderCallback}>
          {renderList}
        </Profiler>
      )}
    </TemplateCom>
  );
};

```